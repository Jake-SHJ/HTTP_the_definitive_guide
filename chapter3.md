# 1부 HTTP: 웹의 기초

## 3장 HTTP 메시지

### 1. 메시지의 흐름

- HTTP 메시지는 HTTP 애플리케이션 간에 주고받은 데이터의 블록들이다.
- 메시지는 클라이언트, 서버, 프락시 사이를 흐른다.

1. 메시지는 원 서버 방향을 인바운드로 하여 송신된다

   - 메시지가 원 서버로 향하는 것은 인바운드로 이동하는 것이고, 모든 처리가 끝난 뒤에 메시지가 사용자 에이전트로 돌아오는 것은 아웃바운드로 이동하는 것이다.

2. 다운스트림으로 흐르는 메시지

   - 요청 메시지냐 응답 메시지냐에 관계없이 모든 메시지는 다운스트림으로 흐른다.
   - 메시지의 발송자는 수신자의 업스트림이다.

### 2. 메시지의 각 부분

- HTTP 메시지는 단순한, 데이터의 구조화된 블록이다.
- 각 메시지는 클라이언트로부터의 요청이나 서버로부터의 응답 중 하나를 포함한다.
- 메시지는 시작줄, 헤더 블록, 본문으로 이루어진다.
- 시작줄은 이것이 어떤 메시지인지 서술, 헤더 블록은 속성, 본문은 데이터를 담고 있다. 본문은 없을 수도 있다.
- 시작줄과 헤더는 그냥 줄 단위로 분리된 아스키 문자열이다. 각 줄은 캐리지 리턴(ASCII 13)과 개행 문자(ASCII 10)로 구성된 두 글자의 줄바꿈 문자열('CRLF'라고 씀)로 끝난다.
- 견고한 애플리케이션이라면 그냥 개행 문자도 받아들일 수 있어야한다. (오래되거나 잘못 만들어진 HTTP 애플리케이션에 대한 호환)
- 엔터티 본문이나 메시지 본문은 단순히 선택적인 데이터 덩어리이며, 시작줄이나 헤더와 달리 이진 데이터를 포함할수도, 비어있을 수도 있다.

1. 메시지 문법

   - 모든 HTTP 메시지는 요청 메시지나 응답 메시지로 분류된다.
   - 요청 메시지의 형식

   ```
   <메서드> <요청 URL> <버전>
   <헤더>

   <엔터티 본문>
   ```

   - 응답 메시지의 형식

   ```
   <버전> <상태 코드> <사유 구절>
   <헤더>

   <엔터티 본문>
   ```

   - 메서드: 클라이언트 측에서 서버가 리소스에 대해 수행해주길 바라는 동작
   - 요청 URL: 요청 대상이 되는 리소스를 지칭하는 완전한 URL 혹은 URL의 경로 구성요소
   - 버전: 이 메시지에서 사용 중인 HTTP의 버전

   ```
   HTTP/<메이저>.<마이너>
   ```

   - 상태코드: 요청 중에 무엇이 일어났는지 설명하는 세 자리의 숫자
   - 사유 구절(reason-phrase): 숫자로 된 상태 코드의 의미를 사람이 이해할 수 있게 설명해주는 짧은 문구
   - 헤더들: 이름, 콜론(:), 선택적인 공백, 값, CRLF가 순서대로 나타나는 0개 이상의 헤더들
   - 엔터티 본문: 임의의 데이터 블록을 포함

2. 시작줄

   - 모든 HTTP 메시지는 시작줄로 시작한다.
   - 요청줄: 요청 메시지의 시작줄, 서버에서 어떤 동작이 일어나야 하는지 설명해주는 메서드와 그 동작에 대한 대상을 지칭하는 요청 URL이 들어있다.
   - 응답줄: 응답 메시지의 시작줄, 응답 메시지에서 쓰인 HTTP의 버전, 숫자로 된 상태 코드, 수행 상태에 대해 설명해주는 텍스트로 된 사유 구절이 들어있다.
   - 메서드: 많이 쓰이는 메서드로는 GET, HEAD, POST, PUT, TRACE, OPTIONS, DELETE 등이 있고, 추가로 구현이 가능하며 이를 확장 메서드라 한다.
   - 상태코드: 100-101/정보, 200-206/성공, 300-305/리다이렉션, 400-415/클라이언트 에러, 500-505/서버 에러
   - 사유 구절: 상태 코드와 일대일로 대응, 어떤 엄격한 규칙도 제공하지 않음
   - 버전 번호: HTTP로 대화하는 애플리케이션들에게 대화 상대의 능력과 메시지의 형식에 대한 단서를 제공해주기 위한 것

3. 헤더

   - 일반 헤더: 요청과 응답 양쪽에 모두 나타날 수 있음
   - 요청 헤더: 요청에 대한 부가 정보를 제공
   - 응답 헤더: 응답에 대한 부가 정보를 제공
   - Entity 헤더: 본문 크기와 콘텐츠, 혹은 리소스 그 자체를 서술
   - 확장 헤더: 명세에 정의되지 않은 새로운 헤더
   - 헤더 문법: 이름, 쉼표, 공백(없어도 됨), 필드 값, CRLF가 순서대로 온다.
   - 헤더를 여러 줄로 나누기: 긴 헤더 줄은 추가 줄 앞에 최소 하나의 스페이스 혹은 탭 문자를 포함하여 여러 줄로 쪼개어 더 읽기 좋게 만들 수 있다.

4. 엔터티 본문

   - 엔터티 본문은 HTTP 메시지의 화물이라고 할 수 있다.
   - 이미지, 비디오, HTML 문서, 소프트웨어 애플리케이션, 신용카드 트랜잭션, 전자우편 등 여러 종류의 디지털 데이터를 실어 나를 수 있다.

### 3. 메서드

- 모든 서버가 모든 메서드를 구현하지 않는다는 것에 주의하라.
- 비록 서버가 모든 메서드를 구현하지 않았다 하더라도 메서드는 대부분 제한적으로 사용될 것이다.

1. 안전한 메서드(Safe Method)

   - HTTP는 안전한 메서드라 불리는 메서드의 집합을 정의한다.
   - GET과 HEAD 메서드는 안전한 메서드이다. 이는 HTTP 요청의 결과로 서버에 어떤 작용도 없음을 의미한다.
   - 안전한 메서드가 서버에 작용을 유발하지 않는다는 보장은 없지만, 서버에 영향을 줄 수 있는 안전하지 않은 메서드가 사용될 때 사용자들에게 그 사실을 알려주는 HTTP 애플리케이션을 만들 수 있도록 하는 것에 그 목적이 있다.

2. GET

   - 주로 서버에게 리소스를 달라고 요청하기 위해 쓰인다.

3. HEAD

   - 정확히 GET처럼 행동하지만, 서버는 응답으로 헤더만을 돌려준다. (엔터티 본문은 결코 반환되지 않는다.)
   - 리소스를 가져오지 않고도 그에 대해 무엇인가를 알아낼 수 있다.
   - 응답의 상태 코드를 통해, 개체가 존재하는지 확인할 수 있다.
   - 헤더를 확인하여 리소스가 변경되었는지 검사할 수 있다.
   - 서버 개발자들은 반드시 반환되는 헤더가 GET으로 얻는 것과 정확히 일치함을 보장해야 한다.

4. PUT

   - PUT 메서드의 의미는, 서버가 요청의 본문을 가지고 요청 URL의 이름대로 새 문서를 만들거나, 이미 URL이 존재한다면 본문을 사용해서 교체하는 것이다.
   - PUT 메서드는 콘텐츠를 변경할 수 있게 해주기 때문에, 많은 웹 서버가 PUT을 수행하기 전에 사용자에게 비밀번호를 입력해서 로그인을 하도록 요구할 것이다.

5. POST

   - POST 메서드는 서버에 입력 데이터를 전송하기 위해 설계되었다.
   - 실제로 HTML 폼을 지원하기 위해 흔히 사용된다.
   - 채워진 폼에 담긴 데이터는 서버로 전송되며, 서버는 이를 모아서 필요로 하는 곳에 보낸다.

6. TRACE

   - TRACE 메서드는 클라이언트에게 자신의 요청이 서버에 도달했을 때 어떻게 보이게 되는지 알려준다.
   - TRACE 요청은 목적지 서버에서 '루프백(loopback)' 진단을 시작한다.
   - 요청 전송의 마지막 단계에 있는 서버는 자신이 받은 요청 메시지를 본문에 넣어 TRACE 응답을 되돌려준다.
   - 클라이언트는 자신과 목적지 서버 사이에 있는 모든 HTTP 애플리케이션(방화벽, 프락시, 게이트웨이 등)의 요청/응답 연쇄를 따라가면서 자신이 보낸 메시지가 망가졌거나 수정되었는지, 만약 그렇다면 어떻게 변경되었는지 확인할 수 있다.
   - TRACE 요청은 진단을 위해 주로 사용하지만, 모든 요청이 TRACE와 같이 일관되게 다룬다고 가정하는 문제가 있다. (예를 들어, POST는 프락시가 바로 통과시키고, GET은 웹 캐시와 같은 다른 HTTP 애플리케이션으로 전송할 수 있다.)
   - TRACE 요청은 어떠한 엔터티 본문도 보낼 수 없다. TRACE 응답의 엔터티 본문에는 서버가 받은 요청이 그대로 들어있다.

7. OPTIONS

   - OPTIONS 메서드는 웹 서버에게 여러 가지 종류의 지원 범위에 대해 물어본다.
   - 특정 리소스에 대해 어떤 메서드가 지원되는지 물어볼 수 있다.

8. DELETE

   - 서버에게 요청 URL로 지정한 리소스를 삭제할 것을 요청한다.
   - 클라이언트는 삭제가 수행되는 것을 보장하지 못한다. 이는 서버가 클라이언트에게 알리지 않고 요청을 무시하는 것을 허용하기 때문이다.

9. 확장 메서드

   - HTTP는 필요에 따라 확장해도 문제가 없도록 설계되어 있으므로, 새로 기능을 추가해도 과거에 구현된 소프트웨어들의 오동작을 유발하지 않는다.
   - 확장 메서드는 HTTP/1.1 명세에 정의되지 않은 메서드다.
   - 확장 메서드에 대해서는 "엄격하게 보내고 관대하게 받아들여라"라는 오랜 규칙에 따르는 것이 가장 좋다.
